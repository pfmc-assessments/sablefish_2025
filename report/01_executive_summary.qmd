
# Executive Summary {-}

## Stock Description {-}

This assessment reports the status of the `r spp` (*Anoplopoma fimbria*, or `black cod') resource off the coast of the United States (U.S.) from southern California to the U.S.-Canadian border using data through `r data_end_year`. The resource is modeled as a single stock, however `r spp` do disperse to and from offshore sea mounts and along the coastal waters of the continental U.S., Mexico, Canada, and Alaska and across the Aleutian Islands to the western Pacific. Net changes in population size or structure due to movement across the assessment boundary are considered negligible, though alternative assumptions are explored using sensitivity model evaluations.

## Catches {-}

Check to see if referencing works @tbl-es-catches

Landings for `r spp` contains various historical landings reconstructions, historical foreign fishery catch data, commercial domestic landings data,  Pacific hake at-sea fishery catch estimates, and recreational landings data. Estimated discards are included for the domestic historical and current commercial landings using available information on discard rates with gear-specific discard mortality rates. The model includes six catch- or discard-based fishery fleets: trawl, hook-and-line, pot, trawl discards, hook-and-line discards, and pot discards. Total landings used in this assessment are shown by fleet in @tbl-es-catches and @fig-es-landings. 

The earliest landings of sablefish off the U.S. West Coast used within in this assessment begin in 1890 with hook-and-line gear. The landings began to slowly increase starting in the 1910s and continued at a roughly constant level until the 1960s, where landings sharply increased due to the expansion of trawling and the use of pot gear (@fig-es-landings). After peaking in the late 1970s, catches slowly decreased until the 2000s when catches generally stabilized roughly between 4,000 and 7,000 mt until present (see @tbl-es-catches for the most recent ten years). The pattern of discarded `r spp` across the time series was similar to catches, though on average discard fleets caught 2% of the landed catch fleets. Over the last 10 years, average annual catch was highest for the hook-and-line fleet (2204 mt), followed by the trawl (1706 mt) and pot (1482 mt) fleets. Over the same period, average annual discards were similar for trawl and hook-and-line gear (80 and 86 mt, respectively) and was lowest for pot gear (51 mt).


```{r, results = "asis"}
#| label: tbl-es-catches
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) catches_es_cap 
#| tbl-pos: H

catches_es_table |>
  dplyr::rename(
    `TWL Discards (mt)` = `TWL_Discards (mt)`,
    `HKL Discards (mt)` = `HKL_Discards (mt)`,
    `Pot Discards (mt)` = `Pot_Discard (mt)`,
    `Total (mt)` = `Total Catch (mt)`
  ) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:8,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    # if want to not have tables the width of the page include the below option:
    latex.use_longtable = TRUE 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  cols_width(
    everything() ~ px(75)
  ) |>
  gt::as_latex()

```

```{r} 
#| label: fig-es-landings
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Catches in metric tons (mt) by year for trawl, pot, and hook-and line gears."
#| fig-alt: "Catches before the 1970s were less than 5,000 mt by year with landings sharply increasing in the 1970s and early 1980s and landings since ranging between approximately 5,000 to 7,500 mt by year."

knitr::include_graphics(
  file.path(model_dir, "plots", "catch2_landings_stacked.png")
)

```

## Data and Assessments {-}

The last benchmark stock assessment for sablefish took place in 2019 and was followed by
update assessments in 2021 ([@Kapur:2021:SSA]) and 2023 ([@johnson_status_2023]).
Changes and additions between the 2023 update assessment and this assessment are listed
in Section \ref{changes}. This assessment used the most recent version of the Stock Synthesis modeling
platform (3.30.24). Primary data sources include landings and age-composition
data from the retained catch. Discarded `r spp` and associated age-composition data (converted from
length-compositions using a length-age key) are also used in this assessment. Weight-at-age data are used
to empirically track changes in mean growth over time.
The relative index of abundance estimated from the National Marine Fisheries Service (NMFS)
Northwest Fisheries Science Center (NWFSC) West Coast Groundfish Bottom Trawl (WCGBT)
Survey, which includes depths from 55-1,280 m, represents the primary source of information
on the stock’s trend and was updated to include the most recent data, covering the period 2003-
2024. This assessment also uses a relative index of abundance from the AFSC/NWFSC Triennial Shelf Survey,
split into early (1980-1992) and late (1995-2004) periods, and the NWFSC Slope Survey conducted from 1998-2002.
Additionally, an environmentally-driven recruitment index was incorporated into the stock assessment to
inform the most recent five years of recruitment.

The assessment is based upon a two-sex, age-structured model starting in 1890 and tracking annual changes in
population dynamics up to an accumulated population age group of 70 years.
Natural mortality was estimated and assumed to be time invariant and equal
between males and females. An empirical weight-at-age approach was implemented
with sex-specific time-varying growth between 2003 – 2024 that was spatially integrated on an annual
basis to represent coastwide trends in growth. Growth prior to 2003 was considered constant. Age
data were grouped by age between 0 – 50, with 50 being used as a data plus group.
Age-based selectivity was estimated as dome-shaped for each fleet and survey, and selectivity time blocks were used
to allow for shifts in selectivity for each fishery fleet. Additonally, selectivity was sex-specific for the mirrored hook-and-line
and pot fleets. Recruitment deviations were estimated from 1975 onwards with no restraint to sum to zero over the main estimation time period.
Steepness (`r h`), the standard deviation of recruitment variability (`r sigma_r`), the functional maturity schedule, and the fucundity
relationship were fixed inputs in the model. Fecundity was time-varying as the product of time-varying weight-at-age data
and a spatially-integrated maturity schedule. Ageing errors were updated for this assessment, and
summary biomass was calculated for ages 3 plus. 

The assessment was fit to data and prior information on natural mortality by minimizing the joint negative log-likelihood.
The prior for *M* assumed a log normal distribution with a median of 0.072 yr$^{-1}$ and a standard error of 0.31. Age composition data
was weighted by downsizing the input samples sizes for each data source following the Francis method. Twelve year projections were conducted that
applied estimated *M*, the final year (i.e., time block) for fleet selectivity, a recent five year average weight-at-age (and similarly fecundity),
and average recruitment. A suite of data and model structure
sensitivites were conducted to examine the influence of individual data sources and base model robustness and stability. While base model results
capture parametric uncertainty and senstivity evaluations explore structural uncertainty, total uncertainty is underestimated in current stock
size and status because this approach does not account for the interaction between them or all possible alternative model structures
for `r spp` population dynamics. 

## Stock Output and Dynamics {-}

For the purposes of this assessment, female spawning biomass is assumed to be proportional to egg and larval production (i.e., spawning output) and the terms spawning biomass and spawning output are used interchangeably through the report.

@tbl-es-sb

```{r, results = "asis"}
#| label: tbl-es-sb
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) ssb_es_cap 
#| tbl-pos: H

ssb_es_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:4,
    decimals = 0
  ) |>
  gt::fmt_number(
    columns = 5:7,
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::cols_width(
    tidyselect::everything() ~ px(75)
  ) |>
  gt::as_latex()

```


```{r} 
#| label: fig-es-sb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of spawning output for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts7_Spawning_output_with_95_intervals.png")
)

```


```{r} 
#| label: fig-es-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of fraction of unfished spawning output for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts9_Relative_spawning_output_intervals.png")
)

```

## Recruitment {-}

```{r, results = "asis"}
#| label: tbl-es-recr
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) recr_es_cap 
#| tbl-pos: H

recr_es_table |>
  dplyr::filter(Year < 2025) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:4,
    decimals = 0
  ) |>
  gt::fmt_number(
    columns = 5:7,
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::cols_width(
    tidyselect::everything() ~ px(75)
  ) |>
  gt::as_latex()

```

```{r} 
#| label: fig-es-recruits
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of age-0 recruits for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png")
)

```

```{r} 
#| label: fig-es-recdevs
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of recruitment deviations for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "recdevs2_withbars.png")
)

```


## Exploitation Status {-}


```{r, results = "asis"}
#| label: tbl-es-spr
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) spr_es_cap 
#| tbl-pos: H

spr_es_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:7,
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::cols_width(
    tidyselect::everything() ~ px(80)
  ) |>
  gt::as_latex()

```


```{r} 
#| label: fig-es-spr
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of fishing intensity for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "SPR3_ratiointerval.png")
)

```


## Ecosysystem Consideration {-}



## Reference Points {-}

```{r, results='asis'}
#| label: 'hcr-es'
#| eval: true
#| echo: false
#| warning: false
a <- knitr::knit_child(here::here("report", "shared_text", "harvest_control_rule.qmd"), quiet = TRUE)
cat(a, sep = '\n')
```

The estimated `r end_year` spawning output relative to unfished of equilibrium spawning output is `r depl_final`, below the management target of 40 percent of unfished spawning output. The fishing intensity is estimated to be below the current management harvest rate limit ($\text{SPR}_{45\%}$) at the end of the time series but is estimated to have been above between the 1970s to the late-2010s (@fig-es-spr). The interaction between the relative spawning output and the ratio of the estimated \gls{spr} to the management target ($\text{SPR}_{45\%}$) indicates that the stock is in the lower quadrant indicating that the overfishing is not occurring and that relative spawning output is below the management targets (@fig-es-spr-phase). The current estimate of fraction unfished is larger than the \gls{msy}, below the \gls{spr} target and relative target biomass reference points (@fig-es-yield) based on $h$ of `r h`.

Reference points were calculated using the estimated selectivities and catch distributions among fleets in the final year of the model, `r end_year` (@tbl-ref-points-es). The estimated sustainable total yield inclusive of both landings and discards was `r catch_spr` mt according to $\text{SPR}_{45\%}$. The spawning output equivalent to 40 percent of unfished spawning output ($\text{SB}_{40\%}$) calculated using the SPR target, ($\text{SPR}_{45\%}$), was `r sb_spr` mt.

```{r, results = "asis"}
#| label: tbl-ref-points-es
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) reference_points_cap 
#| tbl-pos: H

reference_points_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:4,
    rows = c(1:4, 7, 10, 12, 15, 17, 20),
    decimals = 0
  ) |>
  gt::fmt_number(
    columns = 2:4,
    rows = c(5, 8, 9, 13:14, 18:19),
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>  
  gt::tab_style(
    style = list(
      gt::cell_text(style = "italic")
    ),
    locations = gt::cells_body(
      columns = "Reference Point",
      rows = tidyselect::starts_with("Reference")
    )
  ) |>
  gt::sub_missing(
    columns = tidyselect::everything(),
    missing_text = "---"
  ) |>
  gt::as_latex()

```


```{r} 
#| label: fig-es-spr-phase
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Phase plot of fishing intensity versus fraction unfished for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "SPR4_phase.png")
)

```


```{r} 
#| label: fig-es-yield
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated yield curve with reference points for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "yield2_yield_curve_with_refpoints.png")
)

```

## Management Performance {-}


```{r, results = "asis"}
#| label: tbl-es-management
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) recent_management_cap 
#| tbl-pos: H

recent_management_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:6,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::as_latex()

```


## Evaluation of Scientific Uncertainty {-}


```{r, results='asis'}
#| label: 'scientific-uncertainty-es'
#| eval: true
#| echo: false
#| warning: false
a <- knitr::knit_child(here::here("report", "shared_text", "scientific_uncertainty.qmd"), quiet = TRUE)
cat(a, sep = '\n')
```

## Harvest Projections and Decision Tables {-}

The projection of spawning ouput, fraction of unfished, and harvest limits were developed using the base model. The total catches in `r end_year` and `r end_year + 1` were fixed at `r fixed_catch[1]` and `r fixed_catch[2]` mt, respectively, based on recommendations from the \gls{gmt} (@tbl-es-gmt-catch). The \gls{abc} values were projectioned assuming a category 1 time-varying sigma with an initial value of 0.50 in 2027 and a management risk tolerance (P$^*$) of 0.45.  

The catches during the projection period, `r end_year + 2`--`r end_year + 12` were set equal to the year-specific \glsplural{abc} (@tbl-es-projections). The spawning output and fraction of unfished increase during the projection due to the estimated large recruitments in 2020 and 2021 maturing and entering the spawning population, resulting in future \glsplural{ofl} and \glsplural{abc}.

```{r, results = "asis"}
#| label: tbl-es-gmt-catch
#| warning: false
#| echo: false
#| tbl-cap: "Removal assumptions in metric tons (mt) provided by the Groundfish Management Team for 2025-2026 by fleet."
#| tbl-pos: H

gmt_catch |>
  dplyr::select(-comment, -Seas) |>
  dplyr::mutate(
    Fleet = dplyr::case_when(
      Fleet == 1 ~ "Trawl",
      Fleet == 2 ~ "HKL",
      Fleet == 3 ~ "Pot",
      Fleet == 4 ~ "Trawl Discard",
      Fleet == 5 ~ "HKL Discard",
      Fleet == 6 ~ "Pot Discard"
    )
  ) |>
  tidyr::pivot_wider(
    names_from = Fleet,
    values_from = `dead(B)`
  ) |>
  gt::gt() |>
  gt::fmt_number(
    columns = c(2:7),
    decimals = 1
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::as_latex()

```

::: {.landscape}

```{r, results = "asis"}
#| label: tbl-es-projections
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) projections_cap 
#| tbl-pos: H

projections_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = c(2:5, 7:9),
    decimals = 0
  ) |>
  gt::fmt_number(
    columns = c(6, 10),
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::sub_missing(
    columns = tidyselect::everything(),
    missing_text = "---"
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::cols_width(
    everything() ~ px(75)
  ) |>
  gt::as_latex()

```

:::

## Unresolved Problems and Major Uncertainties {-}


```{r, results='asis'}
#| label: 'uncertainties-es'
#| eval: true
#| echo: false
#| warning: false
a <- knitr::knit_child(here::here("report", "shared_text", "unresolved_uncertainties.qmd"), quiet = TRUE)
cat(a, sep = '\n')
```

## Research and Data Needs {-}


```{r, results='asis'}
#| label: 'research-data-es'
#| eval: true
#| echo: false
#| warning: false
a <- knitr::knit_child(here::here("report", "shared_text", "research_data_needs.qmd"), quiet = TRUE)
cat(a, sep = '\n')
```

## Risk Table {-}

```{r, results = "asis"}
#| label: tbl-risk-table
#| warning: false
#| echo: false
#| tbl-cap: "‘Risk Table’ for sablefish to document ecosystem and environmental factors potentially affecting stock productivity and uncertainty or other concerns arising from the stock assessment. Level 1 is a favorable ranking, Level 2 neutral, and Level 3 unfavorable."
#| tbl-pos: H

risk <- read.csv(here::here("report", "rda", "RiskTable.csv") )
risk|>
  gt::gt() |>
  gt::tab_options(
    table.font.size = 8,
    latex.use_longtable = TRUE
  ) |>
  gt::cols_label(
    Ecosystem.and.environmental.conditions = "Ecosystem and environmental conditions",
    Assessment.data.inputs = "Assessment data inputs",
    Assessment.model.fits.and.structural.uncertainty = "Assessment model fits and structural uncertainty"
  ) |>
  gt::cols_width(
    everything() ~ px(200)
  ) |>
  gt::as_latex()
```

