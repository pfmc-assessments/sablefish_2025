# Figures 
 
```{r} 
#| label: 'set-rda-dir-figs'
#| echo: false 
#| warning: false 
#| eval: true 
rda_dir <- here::here('rda_files')
``` 

## Assessment Area

```{r} 
#| label: fig-map
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Map of the assessment area."
#| fig-alt: "Map of the U.S. West Coast with a line indicating that this assessment covers the full U.S. West Coast."
#| fig-width: 7
#| fig-height: 8

mod.names <- c("Management  Range", "Assessment Range")
mod.cols  <- c("blue","lightblue", "yellow")

map('worldHires', regions=c("Canada","Mexico"),
    xlim=c(-130, -114), ylim=c(31, 51),
    col='grey', fill=TRUE, interior=TRUE, , lwd=1)

# map with US states
map('state', regions=c("Wash","Oreg","Calif","Idaho", "Montana","Nevada","Arizona","Utah"),
    add = TRUE,
    col = 'grey', fill = TRUE, interior = TRUE, lwd = 1)
axis(2, at = seq(32, 50, 2), lab = paste0(seq(32, 50, 2), "°N"), las=1)
axis(1, at = seq(-130, -114, 4), lab = paste0(abs(seq(-130, -114, 4)), "°W"))

## add vertical lines indicating range for each stock
# North of 36
text(-128-.8, 40.5, mod.names[1], srt=90)
latrange <- c(32.5, 36) + c(.2, -.2)
lines(rep(-128, 2), latrange, lwd=10, col=mod.cols[1])

# South of 36
latrange <- c(36, 48.5) + c(.2, -.2)
lines(rep(-128, 2), latrange, lwd = 10, col=mod.cols[2])
#text(-128-.8, mean(latrange), mod.names[1], srt=90)
# Assessment area
latrange <- c(32.5, 48.5) + c(.2, -.2)
lines(rep(-126,2), latrange, lwd=10, col=mod.cols[3])
text(-126-.8, mean(latrange), mod.names[2], srt=90)

text(-120, 50, "Canada")
text(-120, 47, "Washington")
text(-121, 44, "Oregon")
text(-119.5, 37, "California")
text(-115.5, 32.1, "Mexico")


``` 


## Fisheries off Canada and Alaska


![Time series of sablefish biomass-based and fishing-based estimates of status in Alaska, British Columbia, and along the U.S. West Coast from the most recent stock assessments. The arrow indicates estimates for the current year of the stock assessment. Vertical and horizontal axes differ by area due to region-dependent reference point use and specifications.](figures/regional_Kobe.png){#fig-reg-kobe height=7in fig-alt=""}

## Data

```{r} 
#| label: fig-data
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Data used in the base model."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "data_plot.png")
)

``` 

\newpage

```{r} 
#| label: fig-landings
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Removals in metric tons (mt) by year and gear."
#| fig-alt: "Removals before the 1970s were less than 5,000 mt by year with removals sharply increasing in the 1970s and early 1980s and removals since ranging between approximately 5,000 to 7,500 mt by year."

knitr::include_graphics(
  file.path(model_dir, "plots", "catch2_landings_stacked.png")
)

```

\pagebreak

```{r} 
#| label: fig-landings-comparison
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of the total removals in metric tons (mt) by year between this assessment and the 2023 assessment."
#| fig-alt: ""

catch_comparison <- dplyr::bind_rows(
  model_output_2023$catch |>
    dplyr::group_by(Yr) |>
    dplyr::summarise(
      assessment = "2023",
      total = sum(kill_bio)),
  model_output$catch |>
    dplyr::group_by(Yr) |>
    dplyr::summarise(
      assessment = "2025",
      total = sum(dead_bio))
) |>
  dplyr::rename(Year = Yr)

ggplot2::ggplot(catch_comparison, ggplot2::aes(x = Year, y = total, color = assessment, linetype = assessment)) +
  ggplot2::geom_line(linewidth = 1) +
  ggplot2::scale_color_viridis_d(begin = 0, end = 0.5) +
  ggplot2::theme_bw() + 
  ggplot2::xlab("Year") + ggplot2::ylab("Total Removals (mt)") 

```

\pagebreak

```{r} 
#| label: fig-alk
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated discard age by length for each gear type."
#| fig-alt: ""

knitr::include_graphics(
   here::here("report", "figures", "compare_data_alk_all_years.png")
)

```

```{r} 
#| label: fig-data-agg-ages
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Aggregated ages across all years by fleet."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat__aggregated_across_time.png")
)

```


```{r} 
#| label: fig-discard-ages-trawl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Ages by year for the trawl discard fleet. All ages are unsexed."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt4mkt0.png")
)

```



```{r} 
#| label: fig-discard-ages-hkl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Ages by year for the hook-and-line discard fleet. All ages are unsexed."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt5mkt0.png")
)

```


```{r} 
#| label: fig-discard-ages-pot
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Ages by year for the pot discard fleet. All ages are unsexed."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt6mkt0.png")
)

```


\pagebreak

```{r} 
#| label: fig-data-trawl-1
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the trawl fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt1mkt0_page1.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-trawl-2
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the trawl fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt1mkt0_page2.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-hkl-1
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the hook-and-line fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt2mkt0_page1.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-hkl-2
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the hook-and-line fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt2mkt0_page2.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-pot-1
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the pot fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt3mkt0_page1.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-pot-2
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition by year and sex for the pot fleet. Females and unsexed are in the top section and males in the bottom section."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt3mkt0_page2.png")
)

```





```{r} 
#| label: fig-index-stand
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Standardized indices overlaid. Each index is rescaled to have mean observation = 1.0."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index9_standcpueall.png")
)

```

\pagebreak



```{r} 
#| label: fig-positive-lat-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Proportion of tows where sablefish was present or absent across all years by latitude for the NWFSC West Coast Groundfish Bottom Trawl survey."
#| fig-alt: ""

 nwfscSurvey::plot_proportion(
    data = wcgbt_catch |> 
      dplyr::mutate(new = factor(cpue_kg_km2 <= 0, levels = c(FALSE, TRUE), labels = c("Present", "Absent"))),
    column_factor = new,
    column_bin = Latitude_dd,
    width = 1,
    boundary = 0,
    bar_width = "equal"
  ) 

```


```{r} 
#| label: fig-positive-depth-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Proportion of tows where sablefish was present or absent across all years by depth (m) for the NWFSC West Coast Groundfish Bottom Trawl survey."
#| fig-alt: ""

 nwfscSurvey::plot_proportion(
    data = wcgbt_catch |> 
      dplyr::mutate(new = factor(cpue_kg_km2 <= 0, levels = c(FALSE, TRUE), labels = c("Present", "Absent"))),
    column_factor = new,
    column_bin = Depth_m,
    width = 100,
    boundary = 0,
    bar_width = "equal"
  ) 

```

\pagebreak


```{r} 
#| label: fig-sex-ratio-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Sex ratio across all years by depth (m) for the NWFSC West Coast Groundfish Bottom Trawl survey."
#| fig-alt: ""

 nwfscSurvey::plot_proportion(
    data = wcgbt_bio |> dplyr::filter(Sex != "U"),
    column_factor = Sex,
    column_bin = Depth_m,
    width = 100,
    boundary = 0,
    bar_width = "equal"
  ) 

```

\pagebreak

```{r} 
#| label: fig-wcgbt-map-density
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Sampling locations for sablefish collected by the NWFSC West Coast Groundfish Bottom Trawl survey between 2003 and 2024. Standard lengths (rounded down to the nearest cm) are shown on the left and age estimates (yr) are shown on the right. Lighter colors represent smaller or younger individuals and darker colors represent larger or older individuals. Latitudinal and inshore-offshore patterns were similar for males and females, thus sexes were combined."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "wcgbt_length_age_density.png")
)

```

\pagebreak

```{r} 
#| label: fig-wcgbt-depth-len-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Length (top; cm) and age (bottom; yr) compositions for sablefish collected by the NWFSC West Coast Groundfish Bottom Trawl Survey between 2003 and 2024 by sex and depth (m). Lighter colors represent smaller or younger individuals and darker colors represent larger or older individuals."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "wcgbts_length_age_compositions.png")
)

```

\pagebreak

```{r} 
#| label: fig-wcgbt-age-sex-ratio
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Observed fraction female by age in the NWFSC West Coast Groundfish Bottom Trawl Survey by year."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "sexratio_age_flt10mkt0.png")
)

```

\pagebreak

```{r} 
#| label: fig-qq-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "QQ plot for the NWFSC WCGBT survey."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "wcgbt_qq.png")
)

```

\pagebreak


```{r} 
#| label: fig-index-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Relative index of abundance for the NWFSC WCGBT survey."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index1_cpuedata_WCGBT.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Age composition data by year from the NWFSC WCGBT survey."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt10mkt0.png")
)

```

```{r} 
#| label: fig-data-wcgbt-mean-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_data_weighting_TA1-8_WCGBT.png")
)

```


```{r} 
#| label: fig-qq-nwfslope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "QQ plot for the NWFSC Slope survey."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "nwfsc_slope_qq.png")
)

```

\pagebreak


```{r} 
#| label: fig-index-nwslope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Relative index of abundance for the NWFSC Slope survey."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index1_cpuedata_NWFSC_Slope.png")
)

```

\pagebreak


```{r} 
#| label: fig-data-nwfsc-slope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt9mkt0.png")
)

```

\pagebreak


```{r} 
#| label: fig-data-nwfsc-slope-mean-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_data_weighting_TA1-8_NWFSC_Slope.png")
)

```

\pagebreak


```{r} 
#| label: fig-qq-tri-early
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "QQ plot for the Triennial survey for the early period, 1980-1992."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "tri_early_qq.png")
)

```

\pagebreak



```{r} 
#| label: fig-qq-tri-late
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "QQ plot for the Triennial survey for the late period, 1995-2004."
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "tri_late_qq.png")
)

```

\pagebreak


```{r} 
#| label: fig-index-tri-early
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Relative index of abundance for the Triennial survey 1980-1992."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index1_cpuedata_Triennial_Early.png")
)

```

\pagebreak


```{r} 
#| label: fig-index-tri-late
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Relative index of abundance for the Triennial survey 1995-2005."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index1_cpuedata_Triennial_Late.png")
)

```

\pagebreak


```{r} 
#| label: fig-data-tri-len-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "triennial_length_age_comparison.png")
)

```


```{r} 
#| label: fig-data-tri-tows
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "triennial_positive_tow_bds.png")
)

```


```{r} 
#| label: fig-data-tri-early
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt7mkt0.png")
)

```

\pagebreak


```{r} 
#| label: fig-data-tri-late
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_flt8mkt0.png")
)

```

\pagebreak


```{r} 
#| label: fig-data-tri-early-mean-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_data_weighting_TA1-8_Triennial_Early.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-tri-late-mean-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agedat_data_weighting_TA1-8_Triennial_Late.png")
)

```

\pagebreak

```{r} 
#| label: fig-data-afslope-index
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "index1_cpuedata_AKFSC_SLOPE.png")
)

```

```{r} 
#| label: fig-data-afslope-len-age
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "afsc_slope_length_age_comparison.png")
)

```


## Biology

```{r} 
#| label: fig-data-watage
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "year_wt_at_age_estimate_survey.png")
)

```

\pagebreak


```{r} 
#| label: fig-maturity-data
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Samples by age that were determined to be functionally mature and immature north and south of 36 degrees north latitude. Immature fish have a functional maturity of 0 and mature fish have a functional maturity of 1. Blue vertical dashed line at age 7."
#| fig-alt: "Age associated with immature and mature fish by area."

load(here::here("data", "maturity_data.rda"))

ggplot2::ggplot(maturity_data |>
  dplyr::mutate(
    Area = dplyr::case_when(latitude >= 36 ~ "North", .default = "South")), 
    ggplot2::aes(x = age, y = functional_maturity)) +
  ggplot2::geom_point() +
  ggplot2::ylab("Functional Maturity") +
  ggplot2::geom_vline(xintercept = 7, color = "blue", linetype = 2) + 
  ggplot2::xlab("Age years") +
  ggplot2::theme_bw() +
  ggplot2::theme(strip.background = ggplot2::element_rect(fill = "white")) +
  ggplot2::facet_wrap(Area ~ .)

```

\newpage

```{r}
#| label: fig-maturity-ogive
#| echo: false
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated maturity-at-age by area and the biomass weighted coastwide (Spatial) maturity curve."
#| fig-alt: "Maturity in the south is later compared to fish in the north with the biomass weighted maturity curve being slightly right shifted compared to the north maturity curve."

load(here::here("data", "spatial_maturity.rda"))

ggplot2::ggplot(spatial_maturity, ggplot2::aes(x = age, y = p, color = Model)) +
  ggplot2::geom_line(linewidth = 1) +
  ggplot2::ylab("Probability Mature") +
  ggplot2::xlab("Age years") +
  ggplot2::scale_colour_viridis_d() + 
  ggplot2::theme_bw() +
  ggplot2::theme(strip.background = ggplot2::element_rect(fill = "white"))

```

\newpage


```{r} 
#| label: fig-rec-index-pred
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: ""

knitr::include_graphics(
  here::here("report", "figures", "rec_dev_index_pred.png")
)

```


```{r} 
#| label: fig-rec-index
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Recruitment deviation index."
#| fig-alt: ""

knitr::include_graphics(
  file.path(model_dir, "plots", "index1_cpuedata_ENV.png")
)

```


## Model Bridging

```{r} 
#| label: fig-ss3-version
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass between Stock Synthesis executable versions."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "0_bridging_compare2_spawnbio_uncertainty.png")
)

```


```{r} 
#| label: fig-data-bridge-ssb-1
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when adding new data."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "1_data_bridging_compare2_spawnbio_uncertainty.png")
)

```


```{r} 
#| label: fig-data-bridge-depl-1
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when adding new data."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "1_data_bridging_compare4_Bratio_uncertainty.png")
)

```


```{r} 
#| label: fig-data-bridge-ssb-2
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when adding new data."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "2_data_bridging_compare2_spawnbio_uncertainty.png")
)

```


```{r} 
#| label: fig-data-bridge-depl-2
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when adding new data."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "2_data_bridging_compare4_Bratio_uncertainty.png")
)

```



```{r} 
#| label: fig-structure-bridge-ssb-3
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when the estimation of annual recruitment deviations is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "3_structure_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-structure-bridge-depl-3
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when the estimation of annual recruitment deviations is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "3_structure_compare3_Bratio.png")
)

```

```{r} 
#| label: fig-structure-bridge-ssb-4
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "4_structure_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-structure-bridge-depl-4
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "4_structure_compare3_Bratio.png")
)

```

```{r} 
#| label: fig-structure-bridge-ssb-5
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "5_structure_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-structure-bridge-depl-5
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  here::here("report", "figures", "5_structure_compare3_Bratio.png")
)

```

\pagebreak

```{r} 
#| label: fig-structure-bridge-ssb-6
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated spawning biomass when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  here::here("report", "figures", "6_structure_compare2_spawnbio_uncertainty.png")
)

```


```{r} 
#| label: fig-structure-bridge-depl-6
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Comparison of estimated fraction unfished when the model structure is revised."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  here::here("report", "figures", "6_structure_compare4_Bratio_uncertainty.png")
)

```

\pagebreak

## Biology


```{r} 
#| label: fig-weight-at-age-female
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Female weight-at-age by year."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "bio5_weightatsize.png")
)

```

```{r} 
#| label: fig-weight-at-age-male
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Male weight-at-age by year."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "bio5_weightatsize2.png")
)

```

```{r} 
#| label: fig-fecundity-maturity
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Spawning output at age based upon maturity and fecundity."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "bio6_maturity.png")
)

```


## Selectivity

ADD CUSTOM SELECTIVITY FIGURES

FISHERY

SURVEY


## Fits to Data

```{r} 
#| label: fig-index-fit-early-triennial
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Fit to index data for Triennial Shelf Slope Survey (1980-1992)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "index2_cpuefit_Triennial_Early.png")
)

```


```{r} 
#| label: fig-index-fit-late-triennial
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Fit to index data for Triennial Shelf Slope Survey (1995-2004)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "index2_cpuefit_Triennial_Late.png")
)

```


```{r} 
#| label: fig-index-fit-nwfsc-slope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Fit to index data for NWFSC Slope Survey."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "index2_cpuefit_NWFSC_Slope.png")
)

```


```{r} 
#| label: fig-index-fit-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Fit to index data for the NWFSC West Coast Groundfish Bottom Trawl Survey."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "index2_cpuefit_WCGBT.png")
)

```

```{r} 
#| label: fig-index-fit-enviro
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Fit to index data for the recuitment index."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "index2_cpuefit_ENV.png")
)

```


```{r} 
#| label: fig-aggregate-age-fit
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Aggregated fit to the age composition data across all years by fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit__aggregated_across_time.png")
)

```


```{r} 
#| label: fig-pearson-trawl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the trawl fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt1mkt0_page2.png")
)

```



```{r} 
#| label: fig-mean-age-trawl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the trawl fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_TWL.png")
)

```


```{r} 
#| label: fig-pearson-hkl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the hook-and-line fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt2mkt0_page2.png")
)

```



```{r} 
#| label: fig-mean-age-hkl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the hook-and-line fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_HKL.png")
)

```

```{r} 
#| label: fig-pearson-pot
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the pot fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt3mkt0_page2.png")
)

```

```{r} 
#| label: fig-mean-age-pot
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the pot fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_Pot.png")
)

```



```{r} 
#| label: fig-pearson-trawl-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the trawl discard fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt4mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-trawl-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the trawl discard fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_TWL_Discards.png")
)

```


```{r} 
#| label: fig-pearson-hkl-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the hook-and-line discard fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt5mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-hkl-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the hook-and-line discard fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_HKL_Discards.png")
)

```


```{r} 
#| label: fig-pearson-pot-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the pot discard fleet. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt6mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-pot-discards
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the pot discard fleet."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_Pot_Discard.png")
)

```


```{r} 
#| label: fig-pearson-tri-early
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the Triennial Survey (1980-1992). Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt7mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-tri-early
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the Triennial Survey (1980-1992)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_Triennial_Early.png")
)

```

```{r} 
#| label: fig-pearson-tri-late
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the Triennial Survey (1995-2004). Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt8mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-tri-late
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the Triennial Survey (1995-2004)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_Triennial_Late.png")
)

```

```{r} 
#| label: fig-pearson-nwfsc-slope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the NWFSC Slope Survey. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt8mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-nwfsc-slope
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the NWFSC Slope Survey."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_NWFSC_Slope.png")
)

```

```{r} 
#| label: fig-pearson-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Pearsons residuals to age composition data from the WCGBT Survey. Closed bubbles are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_residsflt10mkt0.png")
)

```

```{r} 
#| label: fig-mean-age-wcgbt
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Mean age by year with confidence intervals for sexed and unsexed ages from the WCGBT Survey."
#| fig-alt: ""
#| fig-pos: H
#| fig-height: 4

knitr::include_graphics(
  file.path(model_dir, "plots", "comp_agefit_data_weighting_TA1-8_WCGBT.png")
)

```




## Time-series


```{r} 
#| label: fig-sb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of spawning output for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts7_Spawning_output_with_95_intervals.png")
)

```


```{r} 
#| label: fig-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of fraction of unfished spawning output for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts9_Relative_spawning_output_intervals.png")
)

```


```{r} 
#| label: fig-total-biomass
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of total biomass for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts1_Total_biomass_(t).png")
)

```


```{r} 
#| label: fig-recruits
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of age-0 recruits for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png")
)

```

\pagebreak


```{r} 
#| label: fig-recdevs
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of recruitment deviations for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "recdevs2_withbars.png")
)

```



```{r} 
#| label: fig-biasramp
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Bias adjustment applied to the recruitment deviations (red line). Points are transformed variances relative to the assumed variance of recruitment."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "recruit_fit_bias_adjust.png")
)

```


```{r} 
#| label: fig-spr
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated time series of fishing intensity for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "SPR3_ratiointerval.png")
)

```


```{r} 
#| label: fig-spr-phase
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Phase plot of fishing intensity versus fraction unfished for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "SPR4_phase.png")
)

```


```{r} 
#| label: fig-yield
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Estimated yield curve with reference points for the base model."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "yield2_yield_curve_with_refpoints.png")
)

```



```{r} 
#| label: fig-dyn-b0
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Dynamic B0 plot. The lower line shows the time series of estimated spawning output in the presence of fishing mortality. The upper line shows the time series that could occur under the same dynamics (including deviations in recruitment), but without fishing. The point at the left represents the unfished equilibrium."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(model_dir, "plots", "ts_DynamicB0.png")
)

```


## Sensitivity Analyses



## Likelihood Profiles


```{r} 
#| label: fig-r0-profile
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: ""
#| fig-alt: "Change in the negative log-likelihood across a range of log(R0) values."
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_LN(R0)"), "piner_panel_SR_LN(R0).png")
)

```

```{r} 
#| label: fig-r0-profile-ssb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the spawning output across a range of log(R0) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_LN(R0)"), "SR_LN(R0)_trajectories_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-r0-profile-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the fraction unfished across a range of log(R0) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_LN(R0)"), "SR_LN(R0)_trajectories_compare3_Bratio.png")
)

```


```{r} 
#| label: fig-m-profile
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the negative log-likelihood across a range of natural mortality (M) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_NatM_uniform_Fem_GP_1"), "piner_panel_NatM_uniform_Fem_GP_1.png")
)

```

```{r} 
#| label: fig-m-profile-ssb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the spawning output across a range of natural mortality (M) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_NatM_uniform_Fem_GP_1"), "NatM_uniform_Fem_GP_1_trajectories_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-m-profile-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the fraction unfished across a range of natural mortality (M) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_NatM_uniform_Fem_GP_1"), "NatM_uniform_Fem_GP_1_trajectories_compare3_Bratio.png")
)

```



```{r} 
#| label: fig-h-profile
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the negative log-likelihood across a range of steepness (h) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_BH_steep"), "piner_panel_SR_BH_steep.png")
)

```

```{r} 
#| label: fig-h-profile-ssb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the spawning output across a range of steepness (h) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_BH_steep"), "SR_BH_steep_trajectories_compare1_spawnbio.png")
)

```


```{r} 
#| label: fig-h-profile-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the fraction unfished across a range of steepness (h) values."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(profile_dir, paste0(model_name, "_profile_SR_BH_steep"), "SR_BH_steep_trajectories_compare3_Bratio.png")
)

```

## Retrospecitve Analysis

```{r} 
#| label: fig-retro-sb
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the estimate of spawning output when the most recent 10 years of data are removed sequentially."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(retro_dir, paste0(model_name, "_retro_10_yr_peel"), "compare2_spawnbio_uncertainty.png")
)

```


```{r} 
#| label: fig-retro-depl
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the estimate of fraction unfished when the most recent 10 years of data are removed sequentially."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(retro_dir, paste0(model_name, "_retro_10_yr_peel"), "compare4_Bratio_uncertainty.png")
)

```


```{r} 
#| label: fig-squid-plot
#| echo: false 
#| warning: false 
#| eval: true 
#| fig-cap: "Change in the estimate annual recruitment deviations when the most recent 10 years of data are removed sequentially."
#| fig-alt: ""
#| fig-pos: H

knitr::include_graphics(
  file.path(retro_dir, paste0(model_name, "_retro_10_yr_peel"), "recruitment_retrospective_squid.png")
)

```

## Historical Analysis

ADD HISTORICAL ASSESSMENT TIME SERIES FIGURE

