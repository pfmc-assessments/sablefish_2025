# Tables 


```{r}
#| label: tbl-landings
#| warning: false
#| echo: false
#| tbl-cap: "Landings in metric tons (mt) by year for each fleet."

landings <- model_output[["catch"]] |>
  tibble::as_tibble() |>
   dplyr::select(Fleet_Name, Yr, ret_bio) |>
   dplyr::group_by(Yr) |>
   dplyr::mutate(
     ret_bio = round(ret_bio, 0),
     `Total (mt)` = sum(ret_bio)
   ) |>
   tidyr::pivot_wider(
     names_from = Fleet_Name,
     values_from = ret_bio
   ) |>
   dplyr::rename(
     Year = Yr,
     `Trawl (mt)` = TWL,
     `Hook and Line (mt)` = HKL,
     `Pot (mt)` = Pot
   ) |>
   dplyr::ungroup()
knitr::kable(landings)
    
```

\pagebreak


```{r, results = "asis"}
#| label: tbl-management
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) recent_management_cap 
#| tbl-pos: H

recent_management_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:6,
    decimals = 0
  ) |>
  tab_options(
    table.font.size = 12 
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  cols_width(
    everything() ~ px(75)
  ) |>
  as_latex()

```

\pagebreak


```{r, results = "asis"}
#| label: tbl-discard-rates-twl
#| warning: false
#| echo: false
#| tbl-cap: "Discard rate by year for trawl gear."
#| tbl-pos: H

read.csv(here::here("data-processed", "data_commercial_discard_rates.csv")) |>
  dplyr::filter(fleet == 1) |>
  dplyr::select(-month, -fleet) |>
  dplyr::rename(
    Year = year,
    `Discard Rate` = discard_rate,
    `SD` = sd
  ) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:3,
    decimals = 2
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak

```{r, results = "asis"}
#| label: tbl-discard-rates-hkl
#| warning: false
#| echo: false
#| tbl-cap: "Discard rate by year for hook-and-line gear."
#| tbl-pos: H

read.csv(here::here("data-processed", "data_commercial_discard_rates.csv")) |>
  dplyr::filter(fleet == 2) |>
  dplyr::select(-month, -fleet) |>
  dplyr::rename(
    Year = year,
    `Discard Rate` = discard_rate, 
    `SD` = sd
  ) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:3,
    decimals = 2
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak

```{r, results = "asis"}
#| label: tbl-discard-rates-pot
#| warning: false
#| echo: false
#| tbl-cap: "Discard rate by year for pot gear."
#| tbl-pos: H

read.csv(here::here("data-processed", "data_commercial_discard_rates.csv")) |>
  dplyr::filter(fleet == 3) |>
  dplyr::select(-month, -fleet) |>
  dplyr::rename(
    Year = year,
    `Discard Rate` = discard_rate,
    `SD` = sd
  ) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 2:3,
    decimals = 2
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak

```{r}
#| label: tbl-twl-age-samples
#| warning: false
#| echo: false
#| tbl-cap: "Commercial ages by year for the trawl fleet."

read.csv(here::here("data-processed", "data-commercial-age-bds-n.csv")) |>
  dplyr::filter(fleet == "TWL") |>
  dplyr::rename(
    Year = year,
    Trips = trips,
    Samples = samples,
    `Input N` = input_n
  ) |>
  dplyr::select(-fleet) |>
  gt() |>
  gt::fmt_number(
    columns = 4,
    decimals = 1
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-hkl-age-samples
#| warning: false
#| echo: false
#| tbl-cap: "Commercial ages by year for the hook-and-line fleet."

read.csv(here::here("data-processed", "data-commercial-age-bds-n.csv")) |>
  dplyr::filter(fleet == "HKL") |>
  dplyr::rename(
    Year = year,
    Trips = trips,
    Samples = samples,
    `Input N` = input_n
  ) |>
  dplyr::select(-fleet) |>
  gt() |>
  gt::fmt_number(
    columns = 4,
    decimals = 1
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-pot-age-samples
#| warning: false
#| echo: false
#| tbl-cap: "Commercial ages by year for the pot fleet."

read.csv(here::here("data-processed", "data-commercial-age-bds-n.csv")) |>
  dplyr::filter(fleet == "POT") |>
  dplyr::rename(
    Year = year,
    Trips = trips,
    Samples = samples,
    `Input N` = input_n
  ) |>
  dplyr::select(-fleet) |>
  gt() |>
  gt::fmt_number(
    columns = 4,
    decimals = 1
  ) |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak

```{r}
#| label: tbl-wcgbt-strata
#| warning: false
#| echo: false
#| tbl-cap: "Design-based stratification by depth and latitude used to expand composition data for the WCGBT survey."


strata_combo |>
  tidyr::unite(
    "Depth", c(Depth_m.1, Depth_m.2), sep = '-'
  ) |>
  tidyr::unite(
    "Latitude", c(Latitude_dd.1, Latitude_dd.2), sep = '-'
  ) |>
  dplyr::rename(
    `Area (km2)` = area,
    `Depth (m)` = Depth
  ) |>
  dplyr::select(-name) |>
  dplyr::relocate(`Area (km2)`, .after = Latitude) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 3,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  gt::as_latex()

```

\pagebreak

```{r}
#| label: tbl-wcgbt-samples
#| warning: false
#| echo: false
#| tbl-cap: "Samples by year from the NWFSC WCGBT survey."

read.csv(here::here("data-processed", "data-survey-wcgbt-n.csv")) |>
  dplyr::select(-N.Lengthed, -Survey) |>
  dplyr::rename(
    Tows = N.Tows,
    `Positive Tows` = Positive.Tows,
    `Prop. Positive` = Proportion.Positive,
    Aged = N.Aged
  ) |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-nwslope-strata
#| warning: false
#| echo: false
#| tbl-cap: "Design-based stratification by depth and latitude used to expand composition data for the NWFSC Slope survey."


strata_nwfsc_slope |>
  tidyr::unite(
    "Depth", c(Depth_m.1, Depth_m.2), sep = '-'
  ) |>
  tidyr::unite(
    "Latitude", c(Latitude_dd.1, Latitude_dd.2), sep = '-'
  ) |>
  dplyr::rename(
    `Area (km2)` = area,
    `Depth (m)` = Depth
  ) |>
  dplyr::select(-name) |>
  dplyr::relocate(`Area (km2)`, .after = Latitude) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 3,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  gt::as_latex()

```


```{r}
#| label: tbl-nwslope-samples
#| warning: false
#| echo: false
#| tbl-cap: "Samples by year from the NWFSC Slope survey."

read.csv(here::here("data-processed", "data-survey-nwfscslope-n.csv")) |>
  dplyr::select(-N.Lengthed, -Survey) |>
  dplyr::rename(
    Tows = N.Tows,
    `Positive Tows` = Positive.Tows,
    `Prop. Positive` = Proportion.Positive,
    Aged = N.Aged
  ) |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-afslope-strata
#| warning: false
#| echo: false
#| tbl-cap: "Design-based stratification by depth and latitude used to expand composition data for the AFSC Slope survey."


strata_afsc_slope |>
  tidyr::unite(
    "Depth", c(Depth_m.1, Depth_m.2), sep = '-'
  ) |>
  tidyr::unite(
    "Latitude", c(Latitude_dd.1, Latitude_dd.2), sep = '-'
  ) |>
  dplyr::rename(
    `Area (km2)` = area,
    `Depth (m)` = Depth
  ) |>
  dplyr::select(-name) |>
  dplyr::relocate(`Area (km2)`, .after = Latitude) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 3,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  gt::as_latex()

```


```{r}
#| label: tbl-afslope-samples
#| warning: false
#| echo: false
#| tbl-cap: "Samples by year from the AFSC Slope survey."

read.csv(here::here("data-processed", "data-survey-afscslope-n.csv")) |>
  dplyr::select(-N.Lengthed, -Survey) |>
  dplyr::rename(
    Tows = N.Tows,
    `Positive Tows` = Positive.Tows,
    `Prop. Positive` = Proportion.Positive,
    Aged = N.Aged
  ) |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-tri-early-strata
#| warning: false
#| echo: false
#| tbl-cap: "Design-based stratification by depth and latitude used to expand composition data for the Triennial survey between 1980-1992."


strata_triennial_early |>
  tidyr::unite(
    "Depth", c(Depth_m.1, Depth_m.2), sep = '-'
  ) |>
  tidyr::unite(
    "Latitude", c(Latitude_dd.1, Latitude_dd.2), sep = '-'
  ) |>
  dplyr::rename(
    `Area (km2)` = area,
    `Depth (m)` = Depth
  ) |>
  dplyr::select(-name) |>
  dplyr::relocate(`Area (km2)`, .after = Latitude) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 3,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  gt::as_latex()

```


```{r}
#| label: tbl-tri-late-strata
#| warning: false
#| echo: false
#| tbl-cap: "Design-based stratification by depth and latitude used to expand composition data for the Triennial survey between 1995-2004."


strata_triennial_early |>
  tidyr::unite(
    "Depth", c(Depth_m.1, Depth_m.2), sep = '-'
  ) |>
  tidyr::unite(
    "Latitude", c(Latitude_dd.1, Latitude_dd.2), sep = '-'
  ) |>
  dplyr::rename(
    `Area (km2)` = area,
    `Depth (m)` = Depth
  ) |>
  dplyr::select(-name) |>
  dplyr::relocate(`Area (km2)`, .after = Latitude) |>
  gt::gt() |>
  gt::fmt_number(
    columns = 3,
    decimals = 0
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  gt::as_latex()

```

\pagebreak

```{r}
#| label: tbl-tri-samples
#| warning: false
#| echo: false
#| tbl-cap: "Samples by year from the Triennial survey."

dplyr::bind_rows(
  read.csv(here::here("data-processed", "data-survey-triennial-early-n.csv")),
  read.csv(here::here("data-processed", "data-survey-triennial-late-n.csv"))) |>
  dplyr::select(-N.Lengthed, -Survey) |>
  dplyr::rename(
    Tows = N.Tows,
    `Positive Tows` = Positive.Tows,
    `Prop. Positive` = Proportion.Positive,
    Aged = N.Aged
  ) |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

\pagebreak


```{r}
#| label: tbl-maturity-samples
#| warning: false
#| echo: false
#| tbl-cap: "Maturity samples collected by the NWFSC West Coast Groundfish Bottom Trawl survey by year and area where north and south of 36 degress north latitude."

load(here::here("data", "maturity_data.rda"))

maturity_data |>
  dplyr::mutate(
    Area = dplyr::case_when(latitude >= 36 ~ "North", .default = "South")) |>
  dplyr::group_by(year, Area) |>
  dplyr::summarise(
    Samples = dplyr::n()
  ) |>
  tidyr::pivot_wider(
    names_from = Area,
    values_from = Samples,
    names_prefix = "Samples-"
  ) |>
  dplyr::rename(Year = year) |>
  dplyr::ungroup() |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

 {{< pagebreak >}} 
 
```{r}
#| label: tbl-model-config
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) config_cap

config_table |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```


```{r}
#| label: tbl-n-param
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) parcount_cap

parcount_table |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()

```

 {{< pagebreak >}} 
 
::: {.landscape}

```{r}
#| label: tbl-param-asar
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) par_cap 
#| tbl-pos: H

par_table |>
  flextable::flextable() |>
  flextable::fontsize(size = 8) |>
  flextable::width(
    j = c(1, 2, 3, 4, 5, 6, 7),
    width = c(2, 0.5, 0.5, 1.5, 0.5, 0.5, 2.5)
  ) 

#asar::ID_tbl_width_class(
#  plot_name = "parameters.rda",
#  rda_dir = table_dir,
#  portrait_pg_width = 12
#)

```

::: 

 {{< pagebreak >}} 